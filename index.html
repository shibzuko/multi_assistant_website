<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">

    <title>TEST1 Настройки GPT</title>
</head>

<body class="container mt-4">

<form action="#" method="post" target="_blank">
    <h2>Системные настройки GPT</h2>
    <fieldset class="form-group">
        <legend>Модель GPT</legend>
        <div class="form-check">
            <input class="form-check-input" type="radio" name="model" id="gpt-3.5-4k" value="gpt-3.5-turbo-0613" checked>
            <label class="form-check-label" for="gpt-3.5-4k">GPT-3.5 4k</label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="radio" name="model" id="gpt-3.5-16k" value="gpt-3.5-turbo-16k-0613">
            <label class="form-check-label" for="gpt-3.5-16k">GPT-3.5 16k</label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="radio" name="model" id="gpt-4-8k" value="gpt-4-0613">
            <label class="form-check-label" for="gpt-4-8k">GPT-4 8k</label>
        </div>
    </fieldset>

    <fieldset class="form-group">
<!--        <legend>Продвинутые настройки</legend>-->
        <div class="form-group">
            <label for="num_tokens">Количество токенов:</label>
            <input type="number" class="form-control" name="num_tokens" placeholder="От 100 до 4000" id="num_tokens" min="100" max="4000">
        </div>

        <div class="form-group">
            <label for="temperature">Температура ответа:</label>
            <input type="number" class="form-control" name="temperature" placeholder="От 0,0 до 2,0 с шагом 0,01" id="temperature" min="0" max="2" step="0.01">
        </div>
    </fieldset>

    <div class="form-group">
        <label for="promt">Системный промт</label>
        <textarea name="promt" class="form-control"
                  placeholder="Например: 'Ты полезный помощник в роли профессора физики'"
                  id="promt"></textarea>
    </div>

<!--    <div class="form-group">-->
<!--        <label for="vectordb">*Модуль в разработке*</label>-->
<!--        <textarea name="VectorDB" class="form-control"-->
<!--                  placeholder="Токен доступа к БД"-->
<!--                  id="vectordb"></textarea>-->
<!--    </div>-->

    <div>
        <button type="button" class="btn btn-primary" id="sendModelSettings">Сохранить настройки модели</button>
    </div>
    <p>

    <div>
        <a href="link_pinecone.html" class="link_p btn-info" role="button">Дообучение ИИ</a>
    </div>

</form>




<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script>let tg = window.Telegram.WebApp;
tg.expand();

tg.MainButton.textColor = "#FFFFFF";
tg.MainButton.color = "#0BAC00";

document.getElementById("sendModelSettings").addEventListener("click", function() {
    const form = document.querySelector('form');

    const model = form['model'].value;
    const numTokens = form['num_tokens'].value;
    const temperature = form['temperature'].value;
    const promt = form['promt'].value;

    const messageObj = {
        'Model': model,
        'Tokens': numTokens,
        'Temperature': temperature,
        'Promt': promt
    };

    const message = JSON.stringify(messageObj);

    tg.sendData(message);
    tg.MainButton.setText("Настройки сохранены!");
    tg.MainButton.show();
});

document.getElementById("sendAdvancedSettings").addEventListener("click", function() {
        const form = document.querySelector('form');

    const tokendb = form['tokendb'].value;


    const messageObj = {
        'Token DB': tokendb
    };

    const message = JSON.stringify(messageObj);

    tg.sendData(message);
    tg.MainButton.setText("Токен добавлен!");
    tg.MainButton.show();
});
</script>
<script>
    //Изменение диапазона значений:
    document.addEventListener("DOMContentLoaded", function() {
        const modelRadios = document.querySelectorAll('input[name="model"]');
        const tokenInput = document.getElementById("num_tokens");

        modelRadios.forEach(radio => {
            radio.addEventListener("change", function() {
                switch (this.id) {
                    case "gpt-3.5-4k":
                        tokenInput.setAttribute("min", "100");
                        tokenInput.setAttribute("max", "4000");
                        tokenInput.setAttribute("placeholder", "От 100 до 4000");
                        break;
                    case "gpt-3.5-16k":
                        tokenInput.setAttribute("min", "100");
                        tokenInput.setAttribute("max", "16000");
                        tokenInput.setAttribute("placeholder", "От 100 до 16000");
                        break;
                    case "gpt-4-8k":
                        tokenInput.setAttribute("min", "100");
                        tokenInput.setAttribute("max", "8000");
                        tokenInput.setAttribute("placeholder", "От 100 до 8000");
                        break;
                }
            });
        });
    });

    //Сообщение о некорректности данных:
    document.querySelector('form').addEventListener('submit', function(e) {
        const tokensValue = parseInt(tokenInput.value, 10);
        const temperatureValue = parseFloat(document.getElementById("temperature").value);

        if (tokensValue < 100 || tokensValue > parseInt(tokenInput.getAttribute("max"), 10) || isNaN(tokensValue)) {
            alert('Введите корректное количество токенов!');
            e.preventDefault();
        }

        if (temperatureValue < 0 || temperatureValue > 2 || isNaN(temperatureValue)) {
            alert('Введите корректное значение температуры!');
            e.preventDefault();
        }
    });

</script>
<script>
    let tg = window.Telegram.WebApp; //получаем объект webapp телеграма
    tg.expand();  // раскрывает приложение во весь экран
    tg.close();  // закрывает веб приложение после нажатия кнопки
</script>

</body>
</html>
