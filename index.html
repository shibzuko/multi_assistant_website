<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">

    <title>TEST1 Настройки GPT</title>
</head>

<body class="container mt-4">

<form action="#" method="post" target="_blank">
    <h2>Системные настройки GPT</h2>


    <fieldset class="form-group">
        <legend>Режим работы бота</legend>
        <div class="form-check">
            <input class="form-check-input" type="radio" name="mode" id="chatgpt" value="chatgpt" checked>
            <label class="form-check-label" for="chatgpt">ChatGPT</label>
        </div>

        <fieldset class="form-group form-group-transition" id="chatgpt_settings">
            <p>Выберите модель GPT:</p>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="model_gpt" id="gpt-3.5" value="gpt-3.5-turbo-1106" checked>
                <label class="form-check-label" for="gpt-3.5">GPT-3.5 Turbo</label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="model_gpt" id="gpt-4-8k" value="gpt-4-0613">
                <label class="form-check-label" for="gpt-4-8k">GPT-4</label>
            </div>

        </fieldset>



        <div class="form-check">
            <input class="form-check-input" type="radio" name="mode" id="generate_audio" value="tts-1-1106">
            <label class="form-check-label" for="tts-1">Текст в аудио</label>
        </div>

        <fieldset class="form-group form-group-transition" id="tts_settings">
            <p>Модель озвучки:</p>
            <div class="form-check">

                <input class="form-check-input" type="radio" name="model_tts" id="tts-1" value="tts-1-1106" checked>
                <label class="form-check-label" for="tts-1">TTS</label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="model_tts" id="tts-1-hd" value="tts-1-hd-1106">
                <label class="form-check-label" for="tts-1-hd">TTS-HD</label>
            </div>
            <div class="form-check">
                <p>Голос озвучки:</p>
                <input class="form-check-input" type="radio" name="tts_voice" id="onyx" value="onyx" checked>
                <label class="form-check-label" for="onyx">Onyx</label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="tts_voice" id="alloy" value="alloy">
                <label class="form-check-label" for="alloy">Alloy</label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="tts_voice" id="echo" value="echo">
                <label class="form-check-label" for="echo">Echo</label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="tts_voice" id="fable" value="fable">
                <label class="form-check-label" for="fable">Fable</label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="tts_voice" id="nova" value="nova">
                <label class="form-check-label" for="nova">Nova</label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="tts_voice" id="shimmer" value="shimmer">
                <label class="form-check-label" for="shimmer">Shimmer</label>
            </div>
        </fieldset>


        <div class="form-check">
            <input class="form-check-input" type="radio" name="mode" id="whisper-1" value="whisper-1">
            <label class="form-check-label" for="whisper-1">Аудио в текст</label>
        </div>
        <fieldset class="form-group form-group-transition" id="whisper_settings">
            <!-- настройки Whisper -->
        </fieldset>
    </fieldset>



    <div class="form-group">
        <label>*Модуль в разработке*</label>
    </div>

    <div>
        <button type="button" class="btn btn-primary" id="sendModelSettings">Сохранить настройки модели</button>
    </div>

</form>

<script>
    document.querySelectorAll('input[name="mode"]').forEach(function(radio) {
        radio.addEventListener('change', function() {
            const chatGptSettings = document.getElementById('chatgpt_settings');
            const ttsSettings = document.getElementById('tts_settings');
            const whisperSettings = document.getElementById('whisper_settings');

            chatGptSettings.classList.remove('open');
            ttsSettings.classList.remove('open');
            whisperSettings.classList.remove('open');

            if (this.value === 'chatgpt') {
                chatGptSettings.classList.add('open');
            } else if (this.value === 'tts-1-1106') {
                ttsSettings.classList.add('open');
            } else if (this.value === 'whisper-1') {
                whisperSettings.classList.add('open');
            }
        });
    });
</script>


<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script>
        document.getElementById("sendModelSettings").addEventListener("click", function() {
            const form = document.querySelector('form');

            // Получаем значения из формы
            const mode = form['mode'].value; // Это работает, поскольку есть input с именем 'mode'

            // Объявляем переменные здесь, чтобы они были доступны в текущей области видимости
            let model_gpt, model_tts;
            if (mode === 'chatgpt') {
                model_gpt = form['model_gpt'].value; // Выбранная модель GPT
            } else if (mode === 'tts-1-1106') {
                model_tts = form['model_tts'].value; // Выбранная модель TTS
            }

            const tts_voice = form['tts_voice'] ? form['tts_voice'].value : undefined; // Выбранный голос TTS

            const messageObj = {
                'mode': mode,
                'model_gpt': model_gpt,
                'model_tts': model_tts,
                'tts_voice': tts_voice
            };

            // Отфильтруем неопределенные значения
            const messageObjFiltered = Object.fromEntries(Object.entries(messageObj).filter(([_, v]) => v != null));

            const message = JSON.stringify(messageObjFiltered);

            tg.sendData(message);
            tg.MainButton.setText("Настройки сохранены!");
            tg.MainButton.show();
            tg.close();
        });
</script>

<!--</script>-->
<!--<script>-->
<!--    let tg = window.Telegram.WebApp; //получаем объект webapp телеграма-->
<!--    tg.expand();  // раскрывает приложение во весь экран-->
<!--    tg.close();  // закрывает веб приложение после нажатия кнопки-->
<!--</script>-->

</body>
</html>
